#!/bin/sh
# worklog:pre-push-hook:v1
# Auto-sync Worklog data before pushing (committed hooks).
# Set WORKLOG_SKIP_PRE_PUSH=1 to bypass.
set -e
if [ "$WORKLOG_SKIP_PRE_PUSH" = "1" ]; then
  exit 0
fi
skip=0
while read local_ref local_sha remote_ref remote_sha; do
  if [ "$remote_ref" = "refs/worklog/data" ]; then
    skip=1
  fi
done
if [ "$skip" = "1" ]; then
  exit 0
fi
if command -v wl >/dev/null 2>&1; then
  WL=wl
elif command -v worklog >/dev/null 2>&1; then
  WL=worklog
else
  echo "worklog: wl/worklog not found; skipping pre-push sync" >&2
  exit 0
fi
"$WL" sync
exit 0
